# Azure-Pacemaker-Attack

Sniffering tool: Adafruit Bluefruit LE Friend

Analysis tool: Wireshark


**All the .pcapng files could only be viewed using Wireshark**

## Files Description:

- The capturing file **'Azure pacemaker Packets_generalApp'** contains the packets when using a general-used iOS App 'nRF Connect' to connect with the pacemaker. It shows that although a general master could connect with the pacemaker, it is not permitted to retrieve the patient info from the pacemaker. The connection will crash automatically after the 'discovery process', during which the master gets the GATT info (attribute table) from the slave device.

  It's quite interesting that:
1. There is one extra characteristic declearation and one extra descriptor found whose attribute handles are 0x001D and 0x001F respectively (they were not found in the communications between pacemaker and Medtronic App). 
2. Another difference is that the general-used App didn't write data into the attributes 0x0016 and 0x0019 (two CCC descriptors) to trigger the Notification and Indication respectively, although it writes data 0x0002 into descriptor 0x000F to trigger Indication (This is GATT service so it might be unimportant). And absolutely, nothing is written into the characteristic value attribute 0x0012. As for communication between the Medtronic App and pacemaker, data has been written into both descriptors (0x0016, 0x0019) so that the Notification and Indication of attributes 0x0015 and 0x0018 could work. 

- The capturing files (starting with **'Azure pacemaker Packets'**) contain the packets when using the Medtronic 'MyCareLink Heart' App to connect with the pacemaker. The connection could be triggered using the 'Send Transmission' function of the App, and each file contains the aggregate sniffered packets throughout one 'Send Transmission' process.  All the files show that the connection between the Medtronic App and pacemaker is complete, for example, it starts from master transmitting 'CONNECT_REQ' and ends with master transmitting 'LL_TERMINATE_IND'. By analysing the packets, the attribute table of the pacemaker could be generated (See file **'Azure3217 attribute table'**). One interesting thing is that for the communications between pacemaker and Medtronic App, I could capture two communications in two different advertising intervals (advertising interval is 3 min for pacemaker. Mostly two communications occur in two consecutive intervals), and they have the same structures. The only difference is that the first communication contains hundreds of Notifications, however for the second one, at most 2 Notifications. The reason why the second communication exists is still unknown.

#### Note: 
  Although lots of attempts, not all of them contain all the communication info (such as losing some specific packets), probably because of the limitation of the sniffering tool. For the recording file **'Azure pacemaker Packets1'**, the second communication between pacemaker and Medtronic App is not complete (I assume it's because of the sniffer constraints)

## Attributes and operations:

- 0x0015 (Notify): It seems that the attribute 0x0015 contains the patient info, such as heart rate (According to the specification file, the patient info should be encrypted before sent from pacemaker). Because during the communication this attribute keeps notifying ('Notification' is one kind of operation in BLE. The info is sent from slave to master in one direction). 

- 0x0012 (Write): It's assumed that something is written into the attribute 0x0012 to trigger the notification processes, because such Write operations only occur in the communications between Medtronic App and pacemaker. However, the crash of communication between general-used App and pacemaker could due to that the descriptor 0x0016 isn't set as 0x0001 as well. The written data is composed of 30 bytes and always has the similar shapes, for example: *0x19380200000008000006de526175e4ef9dffcc65982046a80fc573e1a253*, *0x1938010000000700000636903df073fb7a886dfcfd17439bf34508cf7*

- 0x0018 (Indicate): For attribute 0x0018, it sends an Indication ('Indication' is one kind of operation in BLE. Similar with Notification, its from slave to master. However, a Confirmation is required from master to slave when the master receives the Indication) before the Notifications start to be transmitted. One Indication from this attribute also occurs in the end of the communication, exactly before the final 'LL_TERMINATE_IND'. 

- 0x001B (Write Without Response): Besides, some data(different in each time, 9 bytes, but only the first byte is not 0x00) keeps being written into the attribute 0x001B regularly throughtout the whole Notification procedure (during the period when hundreds of Notifications are sent to the master). 


#### Note: 
  The data is in little endian mode




